# نظام تتبع الملفات المولدة والتراجع (Rollback System)

## نظرة عامة

نظام تتبع الملفات المولدة (`.mic`) يتيح لك:
- تتبع جميع الملفات المولدة تلقائياً
- عرض تاريخ التوليدات
- التراجع عن التوليدات بمستوى واحد أو أكثر
- عرض إحصائيات التوليد

## ملف التتبع `.mic`

يتم إنشاء ملف `.mic` تلقائياً في جذر المشروع لتتبع جميع الملفات المولدة. الملف يحتوي على:

```json
{
    "version": "1.0",
    "updated_at": "2025-12-02T10:00:00+00:00",
    "history": [
        {
            "id": "gen_1234567890",
            "timestamp": "2025-12-02T10:00:00+00:00",
            "model": "Post",
            "command": "generate",
            "files": [
                {
                    "type": "model",
                    "path": "app/Models/Post.php",
                    "relative_path": "app/Models/Post.php"
                }
            ],
            "metadata": {
                "backend_files": ["model", "controller"],
                "vue_files": ["list_page"],
                "fields_count": 3
            }
        }
    ]
}
```

## الأوامر المتاحة

### 1. عرض قائمة التوليدات

```bash
php artisan mic-sole:rollback --list
```

يعرض جدول بجميع التوليدات مع:
- رقم التسلسل
- معرف التوليد
- اسم الموديل
- التاريخ والوقت
- عدد الملفات المولدة

### 2. عرض الإحصائيات

```bash
php artisan mic-sole:rollback --stats
```

يعرض:
- إجمالي التوليدات
- إجمالي الملفات المولدة
- عدد مرات توليد كل موديل
- آخر توليد

### 3. التراجع بمستوى واحد

```bash
php artisan mic-sole:rollback
```

أو

```bash
php artisan mic-sole:rollback --level=1
```

يحذف آخر توليد (مستوى واحد).

### 4. التراجع بعدة مستويات

```bash
php artisan mic-sole:rollback --level=2
```

يحذف آخر توليدين (مستويين).

```bash
php artisan mic-sole:rollback --level=3
```

يحذف آخر 3 توليدات (ثلاثة مستويات).

### 5. التراجع إلى توليد محدد

```bash
php artisan mic-sole:rollback --id=gen_1234567890 --level=1
```

التراجع من توليد محدد بمستوى واحد.

### 6. مسح جميع السجلات

```bash
php artisan mic-sole:rollback --clear
```

يحذف ملف `.mic` بالكامل (لا يحذف الملفات المولدة).

## أمثلة الاستخدام

### مثال 1: التراجع عن آخر توليد

```bash
php artisan mic-sole:rollback
```

### مثال 2: التراجع عن آخر 3 توليدات

```bash
php artisan mic-sole:rollback --level=3
```

### مثال 3: عرض التاريخ ثم التراجع

```bash
# عرض التاريخ
php artisan mic-sole:rollback --list

# التراجع عن آخر توليدين
php artisan mic-sole:rollback --level=2
```

### مثال 4: عرض الإحصائيات

```bash
php artisan mic-sole:rollback --stats
```

## ملاحظات مهمة

1. **التراجع يحذف الملفات**: عند التراجع، يتم حذف الملفات المولدة نهائياً. تأكد من أنك تريد حذفها قبل التنفيذ.

2. **التراجع لا يعيد الملفات المعدلة**: إذا قمت بتعديل ملف مولّد يدوياً، التراجع سيحذفه فقط ولا يعيد النسخة الأصلية.

3. **التراجع لا يحذف Migrations**: Migrations لا يتم حذفها تلقائياً لأنها قد تكون تم تنفيذها. يجب حذفها يدوياً إذا لزم الأمر.

4. **التراجع لا يحذف Routes**: Routes المضافة إلى `routes/api.php` أو `routes/web.php` لا يتم حذفها تلقائياً.

5. **النسخ الاحتياطي**: النظام يحتفظ بنسخة احتياطية من محتوى الملفات قبل الحذف في `backup` array (للاستخدام المستقبلي).

## التكامل التلقائي

النظام يتكامل تلقائياً مع:
- `CrudGeneratorService`: يسجل جميع الملفات المولدة
- `InitDashboardCommand`: يسجل ملفات إعداد لوحة التحكم

لا حاجة لإعداد إضافي!

## الأمان

- ملف `.mic` مضاف إلى `.gitignore` تلقائياً
- لا يحتوي على معلومات حساسة
- يمكن مشاركته مع الفريق إذا لزم الأمر

